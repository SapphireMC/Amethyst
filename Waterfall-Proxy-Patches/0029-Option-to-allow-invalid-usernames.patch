From bd49bcb935cd73c312f48f057cca325908087a4e Mon Sep 17 00:00:00 2001
From: DenaryDev <denaryplanet@gmail.com>
Date: Sun, 6 Mar 2022 02:54:51 +0500
Subject: [PATCH] Option to allow invalid usernames


diff --git a/flame/src/main/java/io/sapphiremc/amethyst/conf/AmethystConfig.java b/flame/src/main/java/io/sapphiremc/amethyst/conf/AmethystConfig.java
index 0cc087d0..05addf5a 100644
--- a/flame/src/main/java/io/sapphiremc/amethyst/conf/AmethystConfig.java
+++ b/flame/src/main/java/io/sapphiremc/amethyst/conf/AmethystConfig.java
@@ -15,6 +15,10 @@ public class AmethystConfig extends AbstractYamlConfig {
      * Custom bungee name.
      */
     public String bungeeName = "Amethyst";
+    /**
+     * Should usernames with invalid characters allowed?
+     */
+    public boolean allowInvalidUsernames = false;
 
     /**
      * Enable or disable custom motd.
@@ -154,6 +158,7 @@ public class AmethystConfig extends AbstractYamlConfig {
     protected void loadContent()
     {
         bungeeName = getString("general.bungee-name", bungeeName);
+        allowInvalidUsernames = getBoolean("general.allow-invalid-usernames", allowInvalidUsernames);
 
         motdEnabled = getBoolean("motd.enabled", motdEnabled);
         motdFirstLines = getStringList("motd.firstLines", motdFirstLines);
diff --git a/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java b/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java
index 5bac99c8..bba8a39a 100644
--- a/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java
+++ b/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java
@@ -443,7 +443,7 @@ public class InitialHandler extends PacketHandler implements PendingConnection
         Preconditions.checkState( thisState == State.USERNAME, "Not expecting USERNAME" );
         thisState = State.PROCESSING_USERNAME; // Amethyst
 
-        if ( !AllowedCharacters.isValidName( loginRequest.getData(), onlineMode ) )
+        if ( !bungee.getAmethyst().getConfig().allowInvalidUsernames && !AllowedCharacters.isValidName( loginRequest.getData(), onlineMode ) ) // Amethyst - option to allow invalid usernames
         {
             disconnect( bungee.getTranslationComponent( "error.name-invalid" ) );
             return;
-- 
2.37.1.windows.1

