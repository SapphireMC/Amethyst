From d55b2bbfead2725d33e5b1858a908ba52a682f96 Mon Sep 17 00:00:00 2001
From: Denary Planet <denaryplanet@gmail.com>
Date: Sat, 10 Jul 2021 17:22:34 +0500
Subject: [PATCH] Amethyst general patch


diff --git a/api/src/main/java/net/md_5/bungee/api/ProxyServer.java b/api/src/main/java/net/md_5/bungee/api/ProxyServer.java
index a4011335..002aeedb 100644
--- a/api/src/main/java/net/md_5/bungee/api/ProxyServer.java
+++ b/api/src/main/java/net/md_5/bungee/api/ProxyServer.java
@@ -8,6 +8,7 @@ import java.util.Collection;
 import java.util.Map;
 import java.util.UUID;
 import java.util.logging.Logger;
+import dev._2lstudios.flamecord.FlameCord;
 import lombok.Getter;
 import net.md_5.bungee.api.chat.BaseComponent;
 import net.md_5.bungee.api.config.ConfigurationAdapter;
@@ -59,6 +60,17 @@ public abstract class ProxyServer
      */
     public abstract String getTranslation(String name, Object... args);
 
+    // Amethyst start - add method to get message component from messages file
+    /**
+     * Gets a localized base component from messages file.
+     *
+     * @param key translation key
+     * @param args translation arguments
+     * @return the localized base component
+     */
+    public abstract BaseComponent[] getTranslationComponent(String key, Object... args);
+    // Amethyst end
+
     /**
      * Gets the main logger which can be used as a suitable replacement for
      * {@link System#out} and {@link System#err}.
@@ -327,4 +339,12 @@ public abstract class ProxyServer
      */
     public abstract Title createTitle();
 
+    // Amethyst start - add method to get FlameCord's instance
+    /**
+     * Get the FlameCord instance.
+     *
+     * @return flamecord instance
+     */
+    public abstract FlameCord getFlameCord();
+    // Amethyst end
 }
diff --git a/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java b/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java
index a190dfae..2ba0f271 100644
--- a/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java
+++ b/api/src/main/java/net/md_5/bungee/api/plugin/PluginManager.java
@@ -195,7 +195,7 @@ public final class PluginManager
         {
             if ( tabResults == null )
             {
-                sender.sendMessage( ( command.getPermissionMessage() == null ) ? proxy.getTranslation( "no_permission" ) : command.getPermissionMessage() );
+                sender.sendMessage( ( command.getPermissionMessage() == null ) ? proxy.getTranslation( "error_no_permission" ) : command.getPermissionMessage() );
             }
             return true;
         }
diff --git a/chat/src/main/java/net/md_5/bungee/api/ChatColor.java b/chat/src/main/java/net/md_5/bungee/api/ChatColor.java
index d7747deb..d828bf68 100644
--- a/chat/src/main/java/net/md_5/bungee/api/ChatColor.java
+++ b/chat/src/main/java/net/md_5/bungee/api/ChatColor.java
@@ -3,10 +3,13 @@ package net.md_5.bungee.api;
 import com.google.common.base.Preconditions;
 import java.awt.Color;
 import java.util.HashMap;
+import java.util.List;
 import java.util.Locale;
 import java.util.Map;
 import java.util.Objects;
 import java.util.regex.Pattern;
+import java.util.stream.Collectors;
+
 import lombok.Getter;
 
 /**
@@ -211,6 +214,13 @@ public final class ChatColor
         return STRIP_COLOR_PATTERN.matcher( input ).replaceAll( "" );
     }
 
+    // Amethyst start - add method to translate color codes with default char
+    public static String translateAlternateColorCodes(String textToTranslate)
+    {
+        return translateAlternateColorCodes('&', textToTranslate);
+    }
+    // Amethyst end
+
     public static String translateAlternateColorCodes(char altColorChar, String textToTranslate)
     {
         char[] b = textToTranslate.toCharArray();
@@ -225,6 +235,15 @@ public final class ChatColor
         return new String( b );
     }
 
+    // Amethyst start - add method to translate color codes from list
+    public static List<String> translateAlternateColorCodes(List<String> listToTranslate)
+    {
+        if (listToTranslate == null || listToTranslate.isEmpty()) return listToTranslate;
+
+        return listToTranslate.stream().map(ChatColor::translateAlternateColorCodes).collect(Collectors.toList());
+    }
+    // Amethyst end
+
     /**
      * Get the colour represented by the specified code.
      *
diff --git a/flame/src/main/java/dev/_2lstudios/flamecord/configuration/FlameCordConfiguration.java b/flame/src/main/java/dev/_2lstudios/flamecord/configuration/FlameCordConfiguration.java
index f3f602e0..4e84ce45 100644
--- a/flame/src/main/java/dev/_2lstudios/flamecord/configuration/FlameCordConfiguration.java
+++ b/flame/src/main/java/dev/_2lstudios/flamecord/configuration/FlameCordConfiguration.java
@@ -15,13 +15,6 @@ import net.md_5.bungee.config.Configuration;
 import net.md_5.bungee.config.ConfigurationProvider;
 
 public class FlameCordConfiguration {
-    private List<String> colors(final List<String> strings) {
-        for (int i = 0; i < strings.size(); i++) {
-            strings.set(i, ChatColor.translateAlternateColorCodes('&', strings.get(i)));
-        }
-
-        return strings;
-    }
 
     @Getter
     private boolean customMotdEnabled = false;
@@ -52,6 +45,11 @@ public class FlameCordConfiguration {
     @Getter
     private Collection<String> firewallNames = new HashSet<>(List.of("mcspam"));
 
+    @Getter
+    private boolean lobbyEnabled = true;
+    @Getter
+    private Collection<String> lobbies = new HashSet<>(List.of("lobby"));
+
     public FlameCordConfiguration(final ConfigurationProvider configurationProvider) {
         try {
             final String fileName = "./flamecord.yml";
@@ -66,7 +64,7 @@ public class FlameCordConfiguration {
             }
 
             this.customMotdEnabled = setIfUnexistant("custom-motd.enabled", this.customMotdEnabled, configuration);
-            this.customMotdMotds = colors(new ArrayList<>(setIfUnexistant("custom-motd.motds", this.customMotdMotds, configuration)));
+            this.customMotdMotds = ChatColor.translateAlternateColorCodes(new ArrayList<>(setIfUnexistant("custom-motd.motds", this.customMotdMotds, configuration)));
 
             this.loggerInitialhandler = setIfUnexistant("logger.initialhandler", this.loggerInitialhandler, configuration);
             this.loggerExceptions = setIfUnexistant("logger.exceptions", this.loggerExceptions, configuration);
@@ -78,6 +76,9 @@ public class FlameCordConfiguration {
             this.firewallSeconds = setIfUnexistant("firewall.seconds", this.firewallSeconds, configuration);
             this.firewallNames = setIfUnexistant("firewall.names", this.firewallNames, configuration);
 
+            this.lobbyEnabled = setIfUnexistant("lobby.enable", lobbyEnabled, configuration);
+            this.lobbies = setIfUnexistant("lobby.servers", lobbies, configuration);
+
             if (!configurationExists) {
                 configurationProvider.save(configuration, configurationFile);
             }
@@ -114,4 +115,18 @@ public class FlameCordConfiguration {
             return new HashSet<>(configuration.getStringList(arg1));
         }
     }
+
+    public String getRandomLobby()
+    {
+        Collection<String> lobbiesCollection = getLobbies();
+        List<String> lobbyServers = new ArrayList<>( lobbiesCollection );
+        if ( lobbyServers.size() == 1 )
+        {
+            return lobbyServers.get( 0 );
+        } else
+        {
+            Random random = new Random();
+            return lobbyServers.get( random.nextInt( lobbyServers.size() - 1 ) );
+        }
+    }
 }
diff --git a/flame/src/main/java/dev/_2lstudios/flamecord/configuration/MessagesConfiguration.java b/flame/src/main/java/dev/_2lstudios/flamecord/configuration/MessagesConfiguration.java
index 72d48d66..3f47ed2b 100644
--- a/flame/src/main/java/dev/_2lstudios/flamecord/configuration/MessagesConfiguration.java
+++ b/flame/src/main/java/dev/_2lstudios/flamecord/configuration/MessagesConfiguration.java
@@ -30,71 +30,86 @@ public class MessagesConfiguration {
 				configuration = configurationProvider.load(configurationFile);
 			}
 
-			// BungeeCord
-			setIfUnexistant("alert", "&8[&4Alert&8]&r ", configuration);
-			setIfUnexistant("already_connected", "&cYou are already connected to this server!", configuration);
-			setIfUnexistant("already_connected_proxy", "&cYou are already connected to this proxy!", configuration);
-			setIfUnexistant("already_connecting", "&cAlready connecting to this server!", configuration);
-			setIfUnexistant("command_list", "&a[{0}] &e({1}): &r{2}", configuration);
-			setIfUnexistant("connect_kick", "&cKicked whilst connecting to {0}: {1}", configuration);
-			setIfUnexistant("current_server", "&6You are currently connected to {0}.", configuration);
-			setIfUnexistant("fallback_kick",
-					"&cCould not connect to a default or fallback server, please try again later: {0}", configuration);
-			setIfUnexistant("fallback_lobby",
-					"&cCould not connect to target server, you have been moved to a fallback server.", configuration);
-			setIfUnexistant("timeout",
-					"Server not reachable (timeout). Offline? Incorrectly configured address/port/firewall?", configuration);
-			setIfUnexistant("lost_connection", "[Proxy] Lost connection to server.", configuration);
-			setIfUnexistant("mojang_fail", "Error occurred while contacting login servers, are they down?",
-					configuration);
-			setIfUnexistant("no_permission", "&cYou do not have permission to execute this command!", configuration);
-			setIfUnexistant("no_server", "&cThe specified server does not exist.", configuration);
-			setIfUnexistant("no_server_permission", "&cYou don't have permission to access this server.",
-					configuration);
-			setIfUnexistant("outdated_client", "Outdated client! Please use {0}", configuration);
-			setIfUnexistant("outdated_server", "Outdated server! I'm still on {0}", configuration);
-			setIfUnexistant("proxy_full", "Server is full!", configuration);
-			setIfUnexistant("restart", "[Proxy] Proxy restarting.", configuration);
-			setIfUnexistant("server_list", "&6You may connect to the following servers at this time: ", configuration);
-			setIfUnexistant("server_went_down",
-					"&cThe server you were previously on went down, you have been connected to a fallback server",
-					configuration);
-			setIfUnexistant("total_players", "Total players online: {0}", configuration);
-			setIfUnexistant("name_invalid", "Username contains invalid characters.", configuration);
-			setIfUnexistant("ping_cannot_connect", "&c[Bungee] Can't connect to server.", configuration);
-			setIfUnexistant("offline_mode_player", "Not authenticated with Minecraft.net", configuration);
-			setIfUnexistant("message_needed", "&cYou must supply a message.", configuration);
-			setIfUnexistant("error_occurred_player",
-					"&cAn error occurred while parsing your message. (Hover for details)", configuration);
-			setIfUnexistant("error_occurred_console", "&cAn error occurred while parsing your message: {0}",
-					configuration);
-			setIfUnexistant("click_to_connect", "Click to connect to the server", configuration);
-			setIfUnexistant("username_needed", "&cPlease follow this command by a user name.", configuration);
-			setIfUnexistant("user_not_online", "&cThat user is not online.", configuration);
-			setIfUnexistant("user_online_at", "&a{0} &ris online at {1}", configuration);
-			setIfUnexistant("send_cmd_usage",
-					"&cNot enough arguments, usage: /send <server|player|all|current> <target>", configuration);
-			setIfUnexistant("player_only", "&cOnly in game players can use this command", configuration);
-			setIfUnexistant("you_got_summoned", "&6Summoned to {0} by {1}", configuration);
-			setIfUnexistant("command_perms_groups", "&6You have the following groups: {0}", configuration);
-			setIfUnexistant("command_perms_permission", "&9- {0}", configuration);
-			setIfUnexistant("command_ip", "&9IP of {0} is {1}", configuration);
-			setIfUnexistant("illegal_chat_characters", "&cIllegal characters in chat ({0})", configuration);
-
-			// FlameCord
-			setIfUnexistant("firewall_added", "&e{0}&c had been firewalled from the proxy!", configuration);
-			setIfUnexistant("firewall_blocked", "&e{0}&c is firewalled from the proxy, request blocked!",
-					configuration);
-			setIfUnexistant("firewall_info",
-					"&aThere are&b {0} &aaddresses firewalled!\n&aThe firewall will clear in &b{1} &aseconds!",
-					configuration);
-			setIfUnexistant("firewall_cleared", "&b{0}&a addresses had been automatically removed from the firewall!",
-					configuration);
-			setIfUnexistant("flamecord_reload", "&aAll files had been successfully reloaded!", configuration);
-			setIfUnexistant("flamecord_help",
-					"&aFlameCord&b {0}&a by&b LinsaFTW&a &&b Sammwy&r\n&e /flamecord reload&7 >&b Reloads FlameCord files!\n&e /flamecord firewall&7 >&b Shows information about the Firewall!\n&e /flamecord help&7 >&b Shows this message!",
-					configuration);
-			setIfUnexistant("flamecord_nopermission", "&cYou don't have permission to do this!", configuration);
+			// Commands
+			setIfUnexistant( "command_alert_message_needed", "&cВы должны указать сообщение.", configuration );
+			setIfUnexistant( "command_alert", "&8&l[&4&lОбьявление&8&l] &c&l", configuration );
+			setIfUnexistant( "command_find_online_at", "&eИгрок &6{0} &eиграет на сервере &6{1}", configuration );
+			setIfUnexistant( "command_firewall_info","&eСуществует &6{0} &eадресов брандмауэра. Брандмауэр очистится через &6{1} &eсек.", configuration );
+			setIfUnexistant( "command_flamecord_usage", "&cИспользуйте /flame help для просмотра доступных команд", configuration );
+			setIfUnexistant( "command_flamecord_help", """
+					&7&m-----------------&r&7&l{&5Amethyst&7&l}&r&7&m-----------------
+					&8&l* &6/flame firewall &7- &eПоказывает информацию о брандмауэре!
+					&8&l* &6/flame help &7- &eПоказывает это сообщение!
+					&8&l* &6/flame about &7- &eИнформация про Amethyst
+					""", configuration );
+			setIfUnexistant( "command_ip", "&eIP игрока &6{0}&e: &6{1}", configuration );
+			setIfUnexistant( "command_list_header", """
+					&7&m-----------------&r&7&l{&5Amethyst&7&l}&r&7&m-----------------
+					&fСписок всех серверов:""", configuration );
+			setIfUnexistant( "command_list_server", "&e{0}&8: &fОнлайн (&7{1}&f): &7{2}", configuration );
+			setIfUnexistant( "command_list_footer", "&7&m-------------------------------------------", configuration );
+			setIfUnexistant( "command_list_total", "&fВсего игроков на сервере: &e{0}", configuration );
+			setIfUnexistant( "command_lobby_already_in", "&cВы уже подключены к этому серверу!", configuration );
+			setIfUnexistant( "command_lobby_not_found", "&cОй, похоже, что мы не смогли найти ни одного лобби-сервера, сообщите о данной проблеме администрации сервера.", configuration );
+			setIfUnexistant( "command_lobby_attempt", "&7&oПытаемся перенести вас в лобби.", configuration );
+			setIfUnexistant( "command_perms_groups", "&eВаши текущие группы:&6 {0}", configuration );
+			setIfUnexistant( "command_perms_permission", "&7- {0}", configuration );
+			setIfUnexistant( "command_reload", "&aAmethyst успешно перезагружен, но для лучшего эффекта перезапустите его.", configuration );
+			setIfUnexistant( "command_server_current", "&eВы находитесь на сервере &6{0}&e", configuration );
+			setIfUnexistant( "command_server_list", "&eВ настоящее время вы можете подключиться к следующим серверам: &6", configuration );
+			setIfUnexistant( "command_server_text", """
+					&7Онлайн: &f{0}
+					&7Нажмите, чтобы подключиться на этот сервер""", configuration );
+			setIfUnexistant( "command_send_usage", "&cНедостаточно аргументов в команде, используйте: /send <ник|all|current> <сервер>", configuration );
+			setIfUnexistant( "command_send_attempt", "&eПереношу &6{0} &eигрок(-a/-ов) на сервер &6{1}&e.", configuration );
+			setIfUnexistant( "command_send_target", "&eВы были перемещены на сервер &6{0} &eадминистратором &6{1}", configuration );
+			setIfUnexistant(  "command_send_result", "&eРезультаты перемещения:", configuration );
+
+			// Info
+			setIfUnexistant( "info_firewall_added", "&e{0} &cбыл защищен брандмауэром от прокси!", configuration );
+			setIfUnexistant( "info_firewall_blocked", "&e{0} &cзащищен брандмауэром от прокси, запрос заблокирован!",configuration );
+			setIfUnexistant( "info_firewall_cleared", "&e{0} &fадресов были автоматически удалены из брандмауэра!",configuration );
+			setIfUnexistant( "info_restart", """
+                    &cОй, похоже, что нашему прокси надо перезагрузиться
+                    &cВы сможете снова зайти на сервер через пару минут""", configuration );
+
+			// Warnings
+			setIfUnexistant( "warning_already_connecting", "&aПодключение...", configuration );
+			setIfUnexistant( "warning_fallback",  "&cОй, похоже, что сервер, к которому вы попытались подключиться, недоступен, мы попытались перенести вас на запасной сервер.", configuration );
+			setIfUnexistant( "warning_server_went_down", "&cОй, похоже, что сервер, на котором вы играли, внезапно выключился, мы попытались перенести вас на запасной сервер.", configuration );
+
+			// Errors
+			setIfUnexistant( "error_already_connected", "&cВы уже подключены к этому серверву!", configuration );
+			setIfUnexistant( "error_already_connected_proxy", "&cИгрок с таким-же ником уже играет на сервере!", configuration );
+			setIfUnexistant( "error_connect_kick", "&cВы были кикнуты при подключении к серверу {0}: {1}", configuration );
+			setIfUnexistant( "error_fallback_kick", """
+					&cК сожалению мы не смогли найти рабочий основной или запасной сервер
+					&r{0}""", configuration );
+			setIfUnexistant( "error_illegal_chat_characters", "&cНедопустимые символы в чате ({0})", configuration );
+			setIfUnexistant( "error_lost_connection", """
+					&cОй, кажется у вас внезапно пропало соединение с сервером
+                    
+					&cПожалуйста, сообщите об ошибке администрации сервера!""", configuration );
+			setIfUnexistant( "error_message_console", "&cПроизошла ошибкa при обработке вашего сообщения: {0}", configuration );
+			setIfUnexistant( "error_message_player", "&cПроизошла ошибкa при обработке вашего сообщения. (Наведите для информации)", configuration );
+			setIfUnexistant( "error_mojang_fail", "&cНе удалось подключиться к серверу Mojang, повторите попытку чуть позже!", configuration );
+			setIfUnexistant( "error_name_invalid", "&cВаш ник содержит запрещённые символы.", configuration );
+			setIfUnexistant( "error_name_too_long", "&cМаксимальная длина ника 16 символов.", configuration );
+			setIfUnexistant( "error_no_license", "&cИспользуйте лицензионный аккаунт, чтобы зайти на сервер", configuration );
+			setIfUnexistant( "error_no_permission", "&cОй, похоже у вас нет доступа к этой команде.", configuration );
+			setIfUnexistant( "error_no_server", "&cГруппа серверов не найдена, сообщите админинстрации.", configuration );
+			setIfUnexistant( "error_no_server_permission", "&cУ вас нет пропуска на этот сервер.", configuration );
+			setIfUnexistant( "error_outdated_client", "Устаревший клиент, используйте {0}", configuration );
+			setIfUnexistant( "error_outdated_server", "Устаревший сервер, я работаю на {0}", configuration );
+			setIfUnexistant( "error_ping_cannot_connect", "&cНе удалось подключиться к серверу. Сообщите администрации.", configuration );
+			setIfUnexistant( "error_player_only", "&cТолько игроки могут использовать эту команду", configuration );
+			setIfUnexistant( "error_proxy_full", "&cОй, кажется сервер заполнен, повторите попытку позже", configuration );
+			setIfUnexistant( "error_timeout", """
+                    &cСервер недоступен (превышено время ожидания). Не в сети? Неправильно настроенный адрес/порт/брандмауэр?
+                    
+                    &cПожалуйста, сообщите об ошибке администрации сервера!""", configuration );
+			setIfUnexistant( "error_user_not_online", "&cДанный игрок не онлайн.", configuration );
+			setIfUnexistant( "error_username_needed", "&cПожалуйста укажите имя игрока.", configuration );
 
 			if (!configurationExists) {
 				configurationProvider.save(configuration, configurationFile);
@@ -114,7 +129,7 @@ public class MessagesConfiguration {
 
 	public String getTranslation(final String name, final Object... args) {
 		if (!messages.containsKey(name)) {
-			logger.warning("[FlameCord] Tried to get translation '" + name
+			logger.warning("[Amethyst] Tried to get translation '" + name
 					+ "' from messages.yml file but wasn't found. Please try resetting this file or report to a developer.");
 		}
 
diff --git a/flame/src/main/java/dev/_2lstudios/flamecord/firewall/FirewallManager.java b/flame/src/main/java/dev/_2lstudios/flamecord/firewall/FirewallManager.java
index dfb5c6d3..77f433e8 100644
--- a/flame/src/main/java/dev/_2lstudios/flamecord/firewall/FirewallManager.java
+++ b/flame/src/main/java/dev/_2lstudios/flamecord/firewall/FirewallManager.java
@@ -63,7 +63,7 @@ public class FirewallManager {
             final InetSocketAddress iNetSocketAddress = (InetSocketAddress) address;
             final String hostString = iNetSocketAddress.getHostString();
 
-            this.logger.info(flameCord.getMessagesConfiguration().getTranslation("firewall_added", hostString));
+            this.logger.info(flameCord.getMessagesConfiguration().getTranslation("info_firewall_added", hostString));
         }
     }
 
@@ -75,7 +75,7 @@ public class FirewallManager {
             final InetSocketAddress iNetSocketAddress = (InetSocketAddress) address;
             final String hostString = iNetSocketAddress.getHostString();
 
-            this.logger.info(flameCord.getMessagesConfiguration().getTranslation("firewall_blocked", hostString));
+            this.logger.info(flameCord.getMessagesConfiguration().getTranslation("info_firewall_blocked", hostString));
         }
     }
 
@@ -108,7 +108,7 @@ public class FirewallManager {
 
             if (size > 0) {
                 if (flameCord.getFlameCordConfiguration().isFirewallNotify()) {
-                    this.logger.info(flameCord.getMessagesConfiguration().getTranslation("firewall_cleared", size));
+                    this.logger.info(flameCord.getMessagesConfiguration().getTranslation("info_firewall_cleared", size));
                 }
 
                 this.firewalled.clear();
diff --git a/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlert.java b/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlert.java
index 55d2f7b8..3d95b789 100644
--- a/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlert.java
+++ b/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlert.java
@@ -19,7 +19,7 @@ public class CommandAlert extends Command
     {
         if ( args.length == 0 )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "message_needed" ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_alert_message_needed" ) );
         } else
         {
             StringBuilder builder = new StringBuilder();
@@ -29,7 +29,7 @@ public class CommandAlert extends Command
                 args[0] = args[0].substring( 2, args[0].length() );
             } else
             {
-                builder.append( ProxyServer.getInstance().getTranslation( "alert" ) );
+                builder.append( ProxyServer.getInstance().getTranslation( "command_alert" ) );
             }
 
             for ( String s : args )
diff --git a/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlertRaw.java b/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlertRaw.java
index 7292899d..4bbe525b 100644
--- a/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlertRaw.java
+++ b/module/cmd-alert/src/main/java/net/md_5/bungee/module/cmd/alert/CommandAlertRaw.java
@@ -23,7 +23,7 @@ public class CommandAlertRaw extends Command
     {
         if ( args.length == 0 )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "message_needed" ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_alert_message_needed" ) );
         } else
         {
             String message = Joiner.on( ' ' ).join( args );
@@ -40,7 +40,7 @@ public class CommandAlertRaw extends Command
                 }
                 if ( sender instanceof ProxiedPlayer )
                 {
-                    sender.sendMessage( new ComponentBuilder( ProxyServer.getInstance().getTranslation( "error_occurred_player" ) )
+                    sender.sendMessage( new ComponentBuilder( ProxyServer.getInstance().getTranslation( "error_message_player" ) )
                             .event( new HoverEvent( HoverEvent.Action.SHOW_TEXT, new ComponentBuilder( error.getMessage() )
                                     .color( ChatColor.RED )
                                     .create() ) )
@@ -48,7 +48,7 @@ public class CommandAlertRaw extends Command
                     );
                 } else
                 {
-                    sender.sendMessage( ProxyServer.getInstance().getTranslation( "error_occurred_console", error.getMessage() ) );
+                    sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_message_console", error.getMessage() ) );
                 }
             }
         }
diff --git a/module/cmd-find/src/main/java/net/md_5/bungee/module/cmd/find/CommandFind.java b/module/cmd-find/src/main/java/net/md_5/bungee/module/cmd/find/CommandFind.java
index 7ea239ac..42debad6 100644
--- a/module/cmd-find/src/main/java/net/md_5/bungee/module/cmd/find/CommandFind.java
+++ b/module/cmd-find/src/main/java/net/md_5/bungee/module/cmd/find/CommandFind.java
@@ -18,16 +18,16 @@ public class CommandFind extends PlayerCommand
     {
         if ( args.length != 1 )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "username_needed" ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_username_needed" ) );
         } else
         {
             ProxiedPlayer player = ProxyServer.getInstance().getPlayer( args[0] );
             if ( player == null || player.getServer() == null )
             {
-                sender.sendMessage( ProxyServer.getInstance().getTranslation( "user_not_online" ) );
+                sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_user_not_online" ) );
             } else
             {
-                sender.sendMessage( ProxyServer.getInstance().getTranslation( "user_online_at", player.getName(), player.getServer().getInfo().getName() ) );
+                sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_find_online_at", player.getName(), player.getServer().getInfo().getName() ) );
             }
         }
     }
diff --git a/module/cmd-list/src/main/java/net/md_5/bungee/module/cmd/list/CommandList.java b/module/cmd-list/src/main/java/net/md_5/bungee/module/cmd/list/CommandList.java
index c2227110..0334eb3c 100644
--- a/module/cmd-list/src/main/java/net/md_5/bungee/module/cmd/list/CommandList.java
+++ b/module/cmd-list/src/main/java/net/md_5/bungee/module/cmd/list/CommandList.java
@@ -25,7 +25,8 @@ public class CommandList extends Command
     @Override
     public void execute(CommandSender sender, String[] args)
     {
-        for ( ServerInfo server : ProxyServer.getInstance().getServers().values() )
+        sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_list_header" ) );
+        for ( ServerInfo server : ProxyServer.getInstance().getServersCopy().values() )
         {
             if ( !server.canAccess( sender ) )
             {
@@ -37,11 +38,13 @@ public class CommandList extends Command
             {
                 players.add( player.getDisplayName() );
             }
-            Collections.sort( players, String.CASE_INSENSITIVE_ORDER );
+            players.sort( String.CASE_INSENSITIVE_ORDER );
 
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "command_list", server.getName(), server.getPlayers().size(), Util.format( players, ChatColor.RESET + ", " ) ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_list_server", server.getName(), server.getPlayers().size(), Util.format( players, ", " ) ) );
         }
 
-        sender.sendMessage( ProxyServer.getInstance().getTranslation( "total_players", ProxyServer.getInstance().getOnlineCount() ) );
+        sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_list_total", ProxyServer.getInstance().getOnlineCount() ) );
+
+        sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_list_footer" ) );
     }
 }
diff --git a/module/cmd-send/src/main/java/net/md_5/bungee/module/cmd/send/CommandSend.java b/module/cmd-send/src/main/java/net/md_5/bungee/module/cmd/send/CommandSend.java
index f59f9457..1989453c 100644
--- a/module/cmd-send/src/main/java/net/md_5/bungee/module/cmd/send/CommandSend.java
+++ b/module/cmd-send/src/main/java/net/md_5/bungee/module/cmd/send/CommandSend.java
@@ -44,7 +44,7 @@ public class CommandSend extends Command implements TabExecutor
 
         public void lastEntryDone()
         {
-            sender.sendMessage( ChatColor.GREEN.toString() + ChatColor.BOLD + "Send Results:" );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent("command_send_result") );
             for ( Map.Entry<ServerConnectRequest.Result, List<String>> entry : results.entrySet() )
             {
                 ComponentBuilder builder = new ComponentBuilder( "" );
@@ -53,8 +53,8 @@ public class CommandSend extends Command implements TabExecutor
                     builder.event( new HoverEvent( HoverEvent.Action.SHOW_TEXT,
                             new ComponentBuilder( Joiner.on( ", " ).join( entry.getValue() ) ).color( ChatColor.YELLOW ).create() ) );
                 }
-                builder.append( entry.getKey().name() + ": " ).color( ChatColor.GREEN );
-                builder.append( "" + entry.getValue().size() ).bold( true );
+                builder.append( entry.getKey().name() + ": " ).color( ChatColor.GOLD );
+                builder.append( "" + entry.getValue().size() ).color( ChatColor.YELLOW );
                 sender.sendMessage( builder.create() );
             }
         }
@@ -80,7 +80,7 @@ public class CommandSend extends Command implements TabExecutor
                 callback.results.get( result ).add( player.getName() );
                 if ( result == ServerConnectRequest.Result.SUCCESS )
                 {
-                    player.sendMessage( ProxyServer.getInstance().getTranslation( "you_got_summoned", target.getName(), callback.sender.getName() ) );
+                    player.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_send_target", target.getName(), callback.sender.getName() ) );
                 }
 
                 if ( --callback.count == 0 )
@@ -101,13 +101,13 @@ public class CommandSend extends Command implements TabExecutor
     {
         if ( args.length != 2 )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "send_cmd_usage" ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_send_usage" ) );
             return;
         }
         ServerInfo server = ProxyServer.getInstance().getServerInfo( args[1] );
         if ( server == null )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "no_server" ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_no_server" ) );
             return;
         }
 
@@ -119,7 +119,7 @@ public class CommandSend extends Command implements TabExecutor
         {
             if ( !( sender instanceof ProxiedPlayer ) )
             {
-                sender.sendMessage( ProxyServer.getInstance().getTranslation( "player_only" ) );
+                sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_player_only" ) );
                 return;
             }
             ProxiedPlayer player = (ProxiedPlayer) sender;
@@ -136,7 +136,7 @@ public class CommandSend extends Command implements TabExecutor
                 ProxiedPlayer player = ProxyServer.getInstance().getPlayer( args[0] );
                 if ( player == null )
                 {
-                    sender.sendMessage( ProxyServer.getInstance().getTranslation( "user_not_online" ) );
+                    sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_user_not_online" ) );
                     return;
                 }
                 targets = Collections.singletonList( player );
@@ -154,7 +154,7 @@ public class CommandSend extends Command implements TabExecutor
             player.connect( request );
         }
 
-        sender.sendMessage( ChatColor.DARK_GREEN + "Attempting to send " + targets.size() + " players to " + server.getName() );
+        sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_send_attempt", targets.size(), server.getName() ) );
     }
 
     @Override
diff --git a/module/cmd-server/src/main/java/net/md_5/bungee/module/cmd/server/CommandServer.java b/module/cmd-server/src/main/java/net/md_5/bungee/module/cmd/server/CommandServer.java
index 698b420f..00c7ea75 100644
--- a/module/cmd-server/src/main/java/net/md_5/bungee/module/cmd/server/CommandServer.java
+++ b/module/cmd-server/src/main/java/net/md_5/bungee/module/cmd/server/CommandServer.java
@@ -37,10 +37,10 @@ public class CommandServer extends Command implements TabExecutor
         {
             if ( sender instanceof ProxiedPlayer )
             {
-                sender.sendMessage( ProxyServer.getInstance().getTranslation( "current_server", ( (ProxiedPlayer) sender ).getServer().getInfo().getName() ) );
+                sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_server_current", ( (ProxiedPlayer) sender ).getServer().getInfo().getName() ) );
             }
 
-            ComponentBuilder serverList = new ComponentBuilder().appendLegacy( ProxyServer.getInstance().getTranslation( "server_list" ) );
+            ComponentBuilder serverList = new ComponentBuilder().appendLegacy( ProxyServer.getInstance().getTranslation( "command_server_list" ) );
             boolean first = true;
             for ( ServerInfo server : servers.values() )
             {
@@ -50,7 +50,7 @@ public class CommandServer extends Command implements TabExecutor
                     int count = server.getPlayers().size();
                     serverTextComponent.setHoverEvent( new HoverEvent(
                             HoverEvent.Action.SHOW_TEXT,
-                            new ComponentBuilder( count + ( count == 1 ? " player" : " players" ) + "\n" ).appendLegacy( ProxyServer.getInstance().getTranslation( "click_to_connect" ) ).create() )
+                            new ComponentBuilder().append( ProxyServer.getInstance().getTranslationComponent( "command_server_text", count ) ).create() )
                     );
                     serverTextComponent.setClickEvent( new ClickEvent( ClickEvent.Action.RUN_COMMAND, "/server " + server.getName() ) );
                     serverList.append( serverTextComponent );
@@ -69,10 +69,10 @@ public class CommandServer extends Command implements TabExecutor
             ServerInfo server = servers.get( args[0] );
             if ( server == null )
             {
-                player.sendMessage( ProxyServer.getInstance().getTranslation( "no_server" ) );
+                player.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_no_server" ) );
             } else if ( !server.canAccess( player ) )
             {
-                player.sendMessage( ProxyServer.getInstance().getTranslation( "no_server_permission" ) );
+                player.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_no_server_permission" ) );
             } else
             {
                 player.connect( server, ServerConnectEvent.Reason.COMMAND );
diff --git a/proxy/src/main/java/dev/_2lstudios/flamecord/commands/FlameCordCommand.java b/proxy/src/main/java/dev/_2lstudios/flamecord/commands/FlameCordCommand.java
index fa0b59c2..19e31e9c 100644
--- a/proxy/src/main/java/dev/_2lstudios/flamecord/commands/FlameCordCommand.java
+++ b/proxy/src/main/java/dev/_2lstudios/flamecord/commands/FlameCordCommand.java
@@ -12,60 +12,61 @@ import net.md_5.bungee.api.chat.TextComponent;
 import net.md_5.bungee.api.config.ServerInfo;
 import net.md_5.bungee.api.plugin.Command;
 
-public class FlameCordCommand extends Command {
-private final BungeeCord bungeeCord;
+public class FlameCordCommand extends Command
+{
 
-    public FlameCordCommand(final BungeeCord bungeeCord) {
-        super("flamecord");
+    private final BungeeCord bungeeCord;
+
+    public FlameCordCommand(final BungeeCord bungeeCord)
+    {
+        super( "flamecord", "bungeecord.command.flamecord", "flame" );
 
         this.bungeeCord = bungeeCord;
     }
 
     @Override
-    public void execute(final CommandSender sender, final String[] args) {
+    public void execute(final CommandSender sender, final String[] args)
+    {
         final FlameCord flameCord = FlameCord.getInstance();
         final MessagesConfiguration messagesConfiguration = flameCord.getMessagesConfiguration();
 
-        if (sender.hasPermission("flamecord.usage")) {
-            if (args.length > 0) {
-                final String arg0 = args[0];
-
-                switch (arg0) {
-                    case "firewall": {
-                        final FirewallManager firewallManager = flameCord.getFirewallManager();
-                        final int amount = firewallManager.getFirewalled().size(),
-                                seconds = firewallManager.getSeconds();
+        if (args.length > 0)
+        {
+            final String arg0 = args[0];
 
-                        sender.sendMessage(TextComponent.fromLegacyText(
-                                messagesConfiguration.getTranslation("firewall_info", amount, seconds)));
-                        break;
-                    }
-                    case "reload": {
-                        // FlameCord - Collect ips from servers
-                        final Collection<String> whitelistedAddresses = new HashSet<>();
+            switch (arg0)
+            {
+                case "firewall":
+                {
+                    final FirewallManager firewallManager = flameCord.getFirewallManager();
+                    final int amount = firewallManager.getFirewalled().size(), seconds = firewallManager.getSeconds();
 
-                        for (final ServerInfo serverInfo : bungeeCord.getServers().values()) {
-                            whitelistedAddresses.add(serverInfo.getSocketAddress().toString());
-                        }
+                    sender.sendMessage( TextComponent.fromLegacyText( messagesConfiguration.getTranslation( "command_firewall_info", amount, seconds ) ) );
+                    break;
+                }
+                case "reload":
+                {
+                    // FlameCord - Collect ips from servers
+                    final Collection<String> whitelistedAddresses = new HashSet<>();
 
-                        FlameCord.renew(bungeeCord.getLogger(), whitelistedAddresses);
-                        sender.sendMessage(TextComponent
-                                .fromLegacyText(messagesConfiguration.getTranslation("flamecord_reload")));
-                        break;
-                    }
-                    default: {
-                        sender.sendMessage(TextComponent.fromLegacyText(
-                                messagesConfiguration.getTranslation("flamecord_help", bungeeCord.getVersion())));
-                        break;
+                    for ( final ServerInfo serverInfo : bungeeCord.getServers().values() )
+                    {
+                        whitelistedAddresses.add( serverInfo.getSocketAddress().toString() );
                     }
+
+                    FlameCord.renew( bungeeCord.getLogger(), whitelistedAddresses );
+                    sender.sendMessage( TextComponent.fromLegacyText( messagesConfiguration.getTranslation( "command_reload" ) ) );
+                    break;
+                }
+                default:
+                {
+                    sender.sendMessage( TextComponent.fromLegacyText( messagesConfiguration.getTranslation( "command_flamecord_help", bungeeCord.getVersion() ) ) );
+                    break;
                 }
-            } else {
-                sender.sendMessage(TextComponent
-                        .fromLegacyText(messagesConfiguration.getTranslation("flamecord_help", bungeeCord.getVersion())));
             }
-        } else {
-            sender.sendMessage(TextComponent
-                    .fromLegacyText(messagesConfiguration.getTranslation("flamecord_nopermission")));
+            } else
+            {
+            sender.sendMessage( TextComponent.fromLegacyText( messagesConfiguration.getTranslation( "command_flamecord_help", bungeeCord.getVersion() ) ) );
         }
     }
 }
diff --git a/proxy/src/main/java/io/sapphiremc/amethyst/command/CommandLobby.java b/proxy/src/main/java/io/sapphiremc/amethyst/command/CommandLobby.java
new file mode 100644
index 00000000..d2d0193e
--- /dev/null
+++ b/proxy/src/main/java/io/sapphiremc/amethyst/command/CommandLobby.java
@@ -0,0 +1,53 @@
+package io.sapphiremc.amethyst.command;
+
+import dev._2lstudios.flamecord.FlameCord;
+import net.md_5.bungee.BungeeCord;
+import net.md_5.bungee.api.CommandSender;
+import net.md_5.bungee.api.connection.ProxiedPlayer;
+import net.md_5.bungee.api.plugin.Command;
+
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.List;
+
+public class CommandLobby extends Command
+{
+
+    public CommandLobby()
+    {
+        super( "lobby", "bungeecord.command.lobby", "hub" );
+    }
+
+    @Override
+    public void execute(CommandSender sender, String[] args)
+    {
+        if ( !( sender instanceof ProxiedPlayer player ) )
+        {
+            sender.sendMessage( BungeeCord.getInstance().getTranslationComponent( "error_player_only" ) );
+            return;
+        }
+
+        Collection<String> lobbiesCollection = FlameCord.getInstance().getFlameCordConfiguration().getLobbies();
+        List<String> lobbies = new ArrayList<>(lobbiesCollection);
+        if (lobbies.isEmpty())
+        {
+            player.sendMessage( BungeeCord.getInstance().getTranslationComponent( "command_lobby_not_found" ) );
+            return;
+        }
+
+        if ( lobbies.contains( player.getServer().getInfo().getName() ) )
+        {
+            player.sendMessage( BungeeCord.getInstance().getTranslationComponent( "command_lobby_already_in" ) );
+            return;
+        }
+
+        String lobby = FlameCord.getInstance().getFlameCordConfiguration().getRandomLobby();
+        if ( lobby == null )
+        {
+            return;
+        }
+
+        player.connect( BungeeCord.getInstance().getServerInfo( lobby ) );
+        player.sendMessage( BungeeCord.getInstance().getTranslationComponent( "command_lobby_attempt" ) );
+    }
+}
diff --git a/proxy/src/main/java/net/md_5/bungee/BungeeCord.java b/proxy/src/main/java/net/md_5/bungee/BungeeCord.java
index 3f5012f6..cddf36a8 100644
--- a/proxy/src/main/java/net/md_5/bungee/BungeeCord.java
+++ b/proxy/src/main/java/net/md_5/bungee/BungeeCord.java
@@ -14,6 +14,7 @@ import dev._2lstudios.flamecord.FlameCord;
 import dev._2lstudios.flamecord.commands.FlameCordCommand;
 import dev._2lstudios.flamecord.configuration.ModulesConfiguration;
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
+import io.sapphiremc.amethyst.command.CommandLobby;
 import io.github.waterfallmc.waterfall.conf.WaterfallConfiguration;
 import io.github.waterfallmc.waterfall.event.ProxyExceptionEvent;
 import io.github.waterfallmc.waterfall.exception.ProxyPluginEnableDisableException;
@@ -123,8 +124,8 @@ public class BungeeCord extends ProxyServer
     /**
      * Localization bundle.
      */
-    private ResourceBundle baseBundle;
-    private ResourceBundle customBundle;
+   // private ResourceBundle baseBundle; // Amethyst
+   // private ResourceBundle customBundle; // Amethyst
     public EventLoopGroup bossEventLoopGroup, workerEventLoopGroup;
     /**
      * locations.yml save thread.
@@ -209,6 +210,8 @@ public class BungeeCord extends ProxyServer
         // Java uses ! to indicate a resource inside of a jar/zip/other container. Running Bungee from within a directory that has a ! will cause this to muck up.
         Preconditions.checkState( new File( "." ).getAbsolutePath().indexOf( '!' ) == -1, "Cannot use Amethyst in directory with ! in path." );
 
+        // Amethyst start - use FlameCord's messages system
+        /*
         try
         {
             baseBundle = ResourceBundle.getBundle( "messages" );
@@ -217,6 +220,8 @@ public class BungeeCord extends ProxyServer
             baseBundle = ResourceBundle.getBundle( "messages", Locale.ENGLISH );
         }
         reloadMessages();
+        */
+        // Amethyst end
 
         // This is a workaround for quite possibly the weirdest bug I have ever encountered in my life!
         // When jansi attempts to extract its natives, by default it tries to extract a specific version,
@@ -305,7 +310,7 @@ public class BungeeCord extends ProxyServer
         for (final ServerInfo serverInfo : getServers().values()) {
             whitelistedAddresses.add(serverInfo.getSocketAddress().toString());
         }
-        
+
         FlameCord.renew(logger, whitelistedAddresses);
 
         if ( config.isForgeSupport() )
@@ -344,7 +349,7 @@ public class BungeeCord extends ProxyServer
             @Override
             public void run()
             {
-                independentThreadStop( getTranslation( "restart" ), false );
+                independentThreadStop( getTranslation( "info_restart" ), false );
             }
         } );
     }
@@ -431,7 +436,7 @@ public class BungeeCord extends ProxyServer
     @Override
     public void stop()
     {
-        stop( getTranslation( "restart" ) );
+        stop( getTranslation( "info_restart" ) );
     }
 
     @Override
@@ -579,6 +584,8 @@ public class BungeeCord extends ProxyServer
         return "1.18.1-R0.1-SNAPSHOT";
     }
 
+    // Amethyst - use FlameCord's messages system
+    /*
     public void reloadMessages()
     {
         File file = new File( "messages.properties" );
@@ -593,6 +600,7 @@ public class BungeeCord extends ProxyServer
             }
         }
     }
+    */
 
     @Override
     public String getTranslation(String name, Object... args)
@@ -601,6 +609,12 @@ public class BungeeCord extends ProxyServer
         return FlameCord.getInstance().getMessagesConfiguration().getTranslation(name, args);
     }
 
+    @Override
+    public BaseComponent[] getTranslationComponent(String name, Object... args)
+    {
+        return TextComponent.fromLegacyText( getTranslation( name, args ) );
+    }
+
     @Override
     @SuppressWarnings("unchecked")
     public Collection<ProxiedPlayer> getPlayers()
@@ -838,51 +852,78 @@ public class BungeeCord extends ProxyServer
     }
 
     // FlameCord - Method to simplify module registering
-    public void loadModules() {
+    public void loadModules()
+    {
         final ModulesConfiguration modulesConfiguration = FlameCord.getInstance().getModulesConfiguration();
 
         // Bungeecord Commands
-        pluginManager.registerCommand(null, new CommandEnd());
-        pluginManager.registerCommand(null, new CommandBungee());
+        pluginManager.registerCommand( null, new CommandEnd() );
+        pluginManager.registerCommand( null, new CommandBungee() );
 
-        if (modulesConfiguration.reloadEnabled) {
-            pluginManager.registerCommand(null, new CommandReload());
+        if ( modulesConfiguration.reloadEnabled)
+        {
+            pluginManager.registerCommand( null, new CommandReload() );
         }
-        if (modulesConfiguration.ipEnabled) {
-            pluginManager.registerCommand(null, new CommandIP());
+        if ( modulesConfiguration.ipEnabled)
+        {
+            pluginManager.registerCommand( null, new CommandIP() );
         }
-        if (modulesConfiguration.permsEnabled) {
-            pluginManager.registerCommand(null, new CommandPerms());
+        if ( modulesConfiguration.permsEnabled)
+        {
+            pluginManager.registerCommand( null, new CommandPerms() );
         }
 
         // Modules Commands
-        if (modulesConfiguration.alertEnabled) {
-            pluginManager.registerCommand(null, new CommandAlert());
-            pluginManager.registerCommand(null, new CommandAlertRaw());
+        if ( modulesConfiguration.alertEnabled)
+        {
+            pluginManager.registerCommand( null, new CommandAlert() );
+            pluginManager.registerCommand( null, new CommandAlertRaw() );
         }
-        if (modulesConfiguration.findEnabled) {
-            pluginManager.registerCommand(null, new CommandFind());
+        if ( modulesConfiguration.findEnabled)
+        {
+            pluginManager.registerCommand( null, new CommandFind() );
         }
-        if (modulesConfiguration.listEnabled) {
-            pluginManager.registerCommand(null, new CommandList());
+        if ( modulesConfiguration.listEnabled)
+        {
+            pluginManager.registerCommand( null, new CommandList() );
         }
-        if (modulesConfiguration.sendEnabled) {
-            pluginManager.registerCommand(null, new CommandSend());
+        if ( modulesConfiguration.sendEnabled)
+        {
+            pluginManager.registerCommand( null, new CommandSend() );
         }
-        if (modulesConfiguration.serverEnabled) {
-            pluginManager.registerCommand(null, new CommandServer());
+        if ( modulesConfiguration.serverEnabled )
+        {
+            pluginManager.registerCommand( null, new CommandServer() );
         }
 
-        if (modulesConfiguration.reconnectEnabled) {
-            for (ListenerInfo info : getConfig().getListeners()) {
-                if (!info.isForceDefault() && getReconnectHandler() == null) {
-                    setReconnectHandler(new YamlReconnectHandler());
+        if ( modulesConfiguration.reconnectEnabled )
+        {
+            for ( ListenerInfo info : getConfig().getListeners() )
+            {
+                if ( !info.isForceDefault() && getReconnectHandler() == null )
+                {
+                    setReconnectHandler( new YamlReconnectHandler() );
                     break;
                 }
             }
         }
 
+        // Amethyst start - add lobby command
+        if ( getFlameCord().getFlameCordConfiguration().isLobbyEnabled() )
+        {
+            pluginManager.registerCommand( null, new CommandLobby() );
+        }
+        // Amethyst end
+
         // Flamecord - Commands (Had to make it like this because of maven limitations)
-        pluginManager.registerCommand(null, new FlameCordCommand(this));
+        pluginManager.registerCommand( null, new FlameCordCommand( this ) );
+    }
+
+    // Amethyst start - add method to get FlameCord's instance
+    @Override
+    public FlameCord getFlameCord()
+    {
+        return FlameCord.getInstance();
     }
+    // Amethyst end
 }
diff --git a/proxy/src/main/java/net/md_5/bungee/ServerConnector.java b/proxy/src/main/java/net/md_5/bungee/ServerConnector.java
index f2805229..3f30f25b 100644
--- a/proxy/src/main/java/net/md_5/bungee/ServerConnector.java
+++ b/proxy/src/main/java/net/md_5/bungee/ServerConnector.java
@@ -411,7 +411,7 @@ public class ServerConnector extends PacketHandler
     @Override
     public void handle(EncryptionRequest encryptionRequest) throws Exception
     {
-        throw new QuietException( "Server is online mode!" );
+        throw new QuietException( "Please disable online mode on all spigot servers except BungeeCord" );
     }
 
     @Override
@@ -432,7 +432,7 @@ public class ServerConnector extends PacketHandler
             throw CancelSendSignal.INSTANCE;
         }
 
-        String message = bungee.getTranslation( "connect_kick", target.getName(), event.getKickReason() );
+        String message = bungee.getTranslation( "error_connect_kick", target.getName(), event.getKickReason() );
         if ( user.isDimensionChange() )
         {
             user.disconnect( message );
diff --git a/proxy/src/main/java/net/md_5/bungee/UserConnection.java b/proxy/src/main/java/net/md_5/bungee/UserConnection.java
index c63a2b5b..76454950 100644
--- a/proxy/src/main/java/net/md_5/bungee/UserConnection.java
+++ b/proxy/src/main/java/net/md_5/bungee/UserConnection.java
@@ -325,7 +325,7 @@ public final class UserConnection implements ProxiedPlayer
                 callback.done( ServerConnectRequest.Result.ALREADY_CONNECTED, null );
             }
 
-            sendMessage( bungee.getTranslation( "already_connected" ) );
+            sendMessage( bungee.getTranslation( "error_already_connected" ) );
             return;
         }
         if ( pendingConnects.contains( target ) )
@@ -335,7 +335,7 @@ public final class UserConnection implements ProxiedPlayer
                 callback.done( ServerConnectRequest.Result.ALREADY_CONNECTING, null );
             }
 
-            sendMessage( bungee.getTranslation( "already_connecting" ) );
+            sendMessage( bungee.getTranslation( "warning_already_connecting" ) );
             return;
         }
 
@@ -371,14 +371,14 @@ public final class UserConnection implements ProxiedPlayer
                     ServerInfo def = updateAndGetNextServer( target );
                     if ( request.isRetry() && def != null && ( getServer() == null || def != getServer().getInfo() ) )
                     {
-                        sendMessage( bungee.getTranslation( "fallback_lobby" ) );
+                        sendMessage( bungee.getTranslation( "warning_fallback" ) );
                         connect( def, null, true, ServerConnectEvent.Reason.LOBBY_FALLBACK, request.getConnectTimeout() ); // Waterfall
                     } else if ( dimensionChange )
                     {
-                        disconnect( bungee.getTranslation( "fallback_kick", connectionFailMessage( future.cause() ) ) );
+                        disconnect( bungee.getTranslation( "error_fallback_kick", connectionFailMessage( future.cause() ) ) );
                     } else
                     {
-                        sendMessage( bungee.getTranslation( "fallback_kick", connectionFailMessage( future.cause() ) ) );
+                        sendMessage( bungee.getTranslation( "error_fallback_kick", connectionFailMessage( future.cause() ) ) );
                     }
                 }
             }
@@ -403,7 +403,7 @@ public final class UserConnection implements ProxiedPlayer
     {
         if ( cause instanceof ConnectTimeoutException )
         {
-            return bungee.getTranslation( "timeout" );
+            return bungee.getTranslation( "error_timeout" );
         } else
         {
             return cause.getClass().getName();
diff --git a/proxy/src/main/java/net/md_5/bungee/command/CommandIP.java b/proxy/src/main/java/net/md_5/bungee/command/CommandIP.java
index 1fd5a546..97c70f5c 100644
--- a/proxy/src/main/java/net/md_5/bungee/command/CommandIP.java
+++ b/proxy/src/main/java/net/md_5/bungee/command/CommandIP.java
@@ -17,16 +17,16 @@ public class CommandIP extends PlayerCommand
     {
         if ( args.length < 1 )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "username_needed" ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_username_needed" ) );
             return;
         }
         ProxiedPlayer user = ProxyServer.getInstance().getPlayer( args[0] );
         if ( user == null )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "user_not_online" ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "error_user_not_online" ) );
         } else
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "command_ip", args[0], user.getSocketAddress() ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_ip", args[0], user.getSocketAddress() ) );
         }
     }
 }
diff --git a/proxy/src/main/java/net/md_5/bungee/command/CommandPerms.java b/proxy/src/main/java/net/md_5/bungee/command/CommandPerms.java
index 18422669..06147382 100644
--- a/proxy/src/main/java/net/md_5/bungee/command/CommandPerms.java
+++ b/proxy/src/main/java/net/md_5/bungee/command/CommandPerms.java
@@ -23,11 +23,11 @@ public class CommandPerms extends Command
         {
             permissions.addAll( ProxyServer.getInstance().getConfigurationAdapter().getPermissions( group ) );
         }
-        sender.sendMessage( ProxyServer.getInstance().getTranslation( "command_perms_groups", Util.csv( sender.getGroups() ) ) );
+        sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_perms_groups", Util.csv( sender.getGroups() ) ) );
 
         for ( String permission : permissions )
         {
-            sender.sendMessage( ProxyServer.getInstance().getTranslation( "command_perms_permission", permission ) );
+            sender.sendMessage( ProxyServer.getInstance().getTranslationComponent( "command_perms_permission", permission ) );
         }
     }
 }
diff --git a/proxy/src/main/java/net/md_5/bungee/command/CommandReload.java b/proxy/src/main/java/net/md_5/bungee/command/CommandReload.java
index 4eba24fa..2f7a254d 100644
--- a/proxy/src/main/java/net/md_5/bungee/command/CommandReload.java
+++ b/proxy/src/main/java/net/md_5/bungee/command/CommandReload.java
@@ -18,7 +18,7 @@ public class CommandReload extends Command
     public void execute(CommandSender sender, String[] args)
     {
         BungeeCord.getInstance().config.load();
-        BungeeCord.getInstance().reloadMessages();
+        // BungeeCord.getInstance().reloadMessages(); // Amethyst - use FlameCord's messages system
         BungeeCord.getInstance().stopListeners();
         BungeeCord.getInstance().startListeners();
         BungeeCord.getInstance().getPluginManager().callEvent( new ProxyReloadEvent( sender ) );
diff --git a/proxy/src/main/java/net/md_5/bungee/conf/Configuration.java b/proxy/src/main/java/net/md_5/bungee/conf/Configuration.java
index 3b5ce41e..8460b3dd 100644
--- a/proxy/src/main/java/net/md_5/bungee/conf/Configuration.java
+++ b/proxy/src/main/java/net/md_5/bungee/conf/Configuration.java
@@ -133,13 +133,13 @@ public abstract class Configuration implements ProxyConfig
                         ServerInfo destination = newServers.get(destinationName);
                         if (destination == null) {
                             BungeeCord.getInstance().getLogger().severe("Couldn't find server " + listener.getDefaultServer() + " or " + listener.getFallbackServer() + " to put player " + player.getName() + " on");
-                            player.disconnect(BungeeCord.getInstance().getTranslation("fallback_kick", "Not found on reload"));
+                            player.disconnect(BungeeCord.getInstance().getTranslation("error_fallback_kick", "Not found on reload"));
                             continue;
                         }
                         player.connect(destination, (success, cause) -> {
                             if (!success) {
                                 BungeeCord.getInstance().getLogger().log(Level.WARNING, "Failed to connect " + player.getName() + " to " + destination.getName(), cause);
-                                player.disconnect(BungeeCord.getInstance().getTranslation("fallback_kick", cause.getCause().getClass().getName()));
+                                player.disconnect(BungeeCord.getInstance().getTranslation("error_fallback_kick", cause.getCause().getClass().getName()));
                             }
                         });
                     }
diff --git a/proxy/src/main/java/net/md_5/bungee/conf/YamlConfig.java b/proxy/src/main/java/net/md_5/bungee/conf/YamlConfig.java
index ae4c7ac2..52a9fc71 100644
--- a/proxy/src/main/java/net/md_5/bungee/conf/YamlConfig.java
+++ b/proxy/src/main/java/net/md_5/bungee/conf/YamlConfig.java
@@ -51,11 +51,16 @@ public class YamlConfig implements ConfigurationAdapter
     private final File file;
 
     public YamlConfig() {
-        this(new File("config.yml"));
+        this(new File("bungeecord.yml"));
     }
 
     public YamlConfig(File file)
     {
+        File oldFile = new File( "config.yml" );
+        if (oldFile.exists()) {
+            System.out.println("Detected default BungeeCord's config.yml, renaming it to bungeecord.yml");
+            oldFile.renameTo(file);
+        }
         this.file = file;
         DumperOptions options = new DumperOptions();
         options.setDefaultFlowStyle( DumperOptions.FlowStyle.BLOCK );
@@ -103,7 +108,7 @@ public class YamlConfig implements ConfigurationAdapter
         {
             set( "permissions.default", Arrays.asList( new String[]
             {
-                "bungeecord.command.server", "bungeecord.command.list"
+                "bungeecord.command.server", "bungeecord.command.list", "bungeecord.command.lobby" // Amethyst - add lobby command
             } ) );
             set( "permissions.admin", Arrays.asList( new String[]
             {
@@ -114,7 +119,7 @@ public class YamlConfig implements ConfigurationAdapter
         Map<String, Object> groups = get( "groups", null );
         if ( groups == null )
         {
-            set( "groups.md_5", Collections.singletonList( "admin" ) );
+            set( "groups.md_5", Collections.singletonList( "default" ) ); // Amethyst - fix security issue
         }
     }
 
diff --git a/proxy/src/main/java/net/md_5/bungee/connection/DownstreamBridge.java b/proxy/src/main/java/net/md_5/bungee/connection/DownstreamBridge.java
index b10d5b0a..3876ba19 100644
--- a/proxy/src/main/java/net/md_5/bungee/connection/DownstreamBridge.java
+++ b/proxy/src/main/java/net/md_5/bungee/connection/DownstreamBridge.java
@@ -89,7 +89,7 @@ public class DownstreamBridge extends PacketHandler
 
         // Waterfall start
         ServerInfo def = con.updateAndGetNextServer( server.getInfo() );
-        ServerKickEvent event = bungee.getPluginManager().callEvent( new ServerKickEvent( con, server.getInfo(), TextComponent.fromLegacyText( bungee.getTranslation( "server_went_down" ) ), def, ServerKickEvent.State.CONNECTED, ServerKickEvent.Cause.EXCEPTION ) );
+        ServerKickEvent event = bungee.getPluginManager().callEvent( new ServerKickEvent( con, server.getInfo(), TextComponent.fromLegacyText( bungee.getTranslation( "warning_server_went_down" ) ), def, ServerKickEvent.State.CONNECTED, ServerKickEvent.Cause.EXCEPTION ) );
         if ( event.isCancelled() && event.getCancelServer() != null )
         {
             server.setObsolete( true );
@@ -116,7 +116,7 @@ public class DownstreamBridge extends PacketHandler
         {
             // Waterfall start
             ServerInfo def = con.updateAndGetNextServer( server.getInfo() );
-            ServerKickEvent event = bungee.getPluginManager().callEvent( new ServerKickEvent( con, server.getInfo(), TextComponent.fromLegacyText( bungee.getTranslation( "lost_connection" ) ), def, ServerKickEvent.State.CONNECTED, ServerKickEvent.Cause.LOST_CONNECTION ) );
+            ServerKickEvent event = bungee.getPluginManager().callEvent( new ServerKickEvent( con, server.getInfo(), TextComponent.fromLegacyText( bungee.getTranslation( "error_lost_connection" ) ), def, ServerKickEvent.State.CONNECTED, ServerKickEvent.Cause.LOST_CONNECTION ) );
             if ( event.isCancelled() && event.getCancelServer() != null )
             {
                 server.setObsolete( true );
diff --git a/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java b/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java
index 51b5afc2..5a1fda28 100644
--- a/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java
+++ b/proxy/src/main/java/net/md_5/bungee/connection/InitialHandler.java
@@ -176,7 +176,7 @@ public class InitialHandler extends PacketHandler implements PendingConnection
     public void handle(LegacyHandshake legacyHandshake) throws Exception
     {
         this.legacy = true;
-        ch.close( bungee.getTranslation( "outdated_client", bungee.getGameVersion() ) );
+        ch.close( bungee.getTranslation( "error_outdated_client", bungee.getGameVersion() ) );
     }
 
     @Override
@@ -265,7 +265,7 @@ public class InitialHandler extends PacketHandler implements PendingConnection
             {
                 if ( error != null )
                 {
-                    result = getPingInfo( bungee.getTranslation( "ping_cannot_connect" ), protocol );
+                    result = getPingInfo( bungee.getTranslation( "error_ping_cannot_connect" ), protocol );
                     bungee.getLogger().log( Level.WARNING, "Error pinging remote server", error );
                 }
 
@@ -397,10 +397,10 @@ public class InitialHandler extends PacketHandler implements PendingConnection
                 {
                     if ( handshake.getProtocolVersion() > bungee.getProtocolVersion() )
                     {
-                        disconnect( bungee.getTranslation( "outdated_server", bungee.getGameVersion() ) );
+                        disconnect( bungee.getTranslation( "error_outdated_server", bungee.getGameVersion() ) );
                     } else
                     {
-                        disconnect( bungee.getTranslation( "outdated_client", bungee.getGameVersion() ) );
+                        disconnect( bungee.getTranslation( "error_outdated_client", bungee.getGameVersion() ) );
                     }
                     return;
                 }
@@ -420,7 +420,7 @@ public class InitialHandler extends PacketHandler implements PendingConnection
 
         if ( !AllowedCharacters.isValidName( loginRequest.getData(), onlineMode ) )
         {
-            disconnect( bungee.getTranslation( "name_invalid" ) );
+            disconnect( bungee.getTranslation( "error_name_invalid" ) );
             return;
         }
 
@@ -437,7 +437,7 @@ public class InitialHandler extends PacketHandler implements PendingConnection
         int limit = BungeeCord.getInstance().config.getPlayerLimit();
         if ( limit > 0 && bungee.getOnlineCount() >= limit )
         {
-            disconnect( bungee.getTranslation( "proxy_full" ) );
+            disconnect( bungee.getTranslation( "error_proxy_full" ) );
             return;
         }
 
@@ -445,7 +445,7 @@ public class InitialHandler extends PacketHandler implements PendingConnection
         // We can just check by UUID here as names are based on UUID
         if ( !isOnlineMode() && bungee.getPlayer( getUniqueId() ) != null )
         {
-            disconnect( bungee.getTranslation( "already_connected_proxy" ) );
+            disconnect( bungee.getTranslation( "error_already_connected_proxy" ) );
             return;
         }
 
@@ -537,10 +537,10 @@ public class InitialHandler extends PacketHandler implements PendingConnection
                         finish();
                         return;
                     }
-                    disconnect( bungee.getTranslation( "offline_mode_player" ) );
+                    disconnect( bungee.getTranslation( "error_no_license" ) );
                 } else
                 {
-                    disconnect( bungee.getTranslation( "mojang_fail" ) );
+                    disconnect( bungee.getTranslation( "error_mojang_fail" ) );
                     bungee.getLogger().log( Level.SEVERE, "Error authenticating " + getName() + " with minecraft.net", error );
                 }
             }
@@ -562,14 +562,14 @@ public class InitialHandler extends PacketHandler implements PendingConnection
             if ( oldName != null )
             {
                 // TODO See #1218
-                oldName.disconnect( bungee.getTranslation( "already_connected_proxy" ) );
+                oldName.disconnect( bungee.getTranslation( "error_already_connected_proxy" ) );
             }
             // And then also for their old UUID
             ProxiedPlayer oldID = bungee.getPlayer( getUniqueId() );
             if ( oldID != null )
             {
                 // TODO See #1218
-                oldID.disconnect( bungee.getTranslation( "already_connected_proxy" ) );
+                oldID.disconnect( bungee.getTranslation( "error_already_connected_proxy" ) );
             }
         } else
         {
@@ -578,7 +578,7 @@ public class InitialHandler extends PacketHandler implements PendingConnection
             if ( oldName != null )
             {
                 // TODO See #1218
-                disconnect( bungee.getTranslation( "already_connected_proxy" ) );
+                disconnect( bungee.getTranslation( "error_already_connected_proxy" ) );
                 return;
             }
 
diff --git a/proxy/src/main/java/net/md_5/bungee/connection/UpstreamBridge.java b/proxy/src/main/java/net/md_5/bungee/connection/UpstreamBridge.java
index e354032a..5746834a 100644
--- a/proxy/src/main/java/net/md_5/bungee/connection/UpstreamBridge.java
+++ b/proxy/src/main/java/net/md_5/bungee/connection/UpstreamBridge.java
@@ -158,7 +158,7 @@ public class UpstreamBridge extends PacketHandler
             char c = chat.getMessage().charAt( index );
             if ( !AllowedCharacters.isChatAllowedCharacter( c ) )
             {
-                con.disconnect( bungee.getTranslation( "illegal_chat_characters", Util.unicode( c ) ) );
+                con.disconnect( bungee.getTranslation( "error_illegal_chat_characters", Util.unicode( c ) ) );
                 throw CancelSendSignal.INSTANCE;
             } else if (empty && !Character.isWhitespace(c)) {
                 empty = false;
diff --git a/proxy/src/main/resources/messages.properties b/proxy/src/main/resources/messages.properties
deleted file mode 100644
index 5890e8c9..00000000
--- a/proxy/src/main/resources/messages.properties
+++ /dev/null
@@ -1,39 +0,0 @@
-alert=\u00a78[\u00a74Alert\u00a78]\u00a7r 
-already_connected=\u00a7cYou are already connected to this server!
-already_connected_proxy=\u00a7cYou are already connected to this proxy!
-already_connecting=\u00a7cAlready connecting to this server!
-command_list=\u00a7a[{0}] \u00a7e({1}): \u00a7r{2}
-connect_kick=\u00a7cKicked whilst connecting to {0}: {1}
-current_server=\u00a76You are currently connected to {0}.
-fallback_kick=\u00a7cCould not connect to a default or fallback server, please try again later: {0}
-fallback_lobby=\u00a7cCould not connect to target server, you have been moved to a fallback server.
-timeout=Server not reachable (timeout). Offline? Incorrectly configured address/port/firewall?
-lost_connection=[Proxy] Lost connection to server.
-mojang_fail=Error occurred while contacting login servers, are they down?
-no_permission=\u00a7cYou do not have permission to execute this command!
-no_server=\u00a7cThe specified server does not exist.
-no_server_permission=\u00a7cYou don''t have permission to access this server.
-outdated_client=Outdated client! Please use {0}
-outdated_server=Outdated server! I''m still on {0}
-proxy_full=Server is full!
-restart=[Proxy] Proxy restarting.
-server_list=\u00a76You may connect to the following servers at this time: 
-server_went_down=\u00a7cThe server you were previously on went down, you have been connected to a fallback server
-total_players=Total players online: {0}
-name_invalid=Username contains invalid characters.
-ping_cannot_connect=\u00a7c[Bungee] Can''t connect to server.
-offline_mode_player=Not authenticated with Minecraft.net
-message_needed=\u00a7cYou must supply a message.
-error_occurred_player=\u00a7cAn error occurred while parsing your message. (Hover for details)
-error_occurred_console=\u00a7cAn error occurred while parsing your message: {0}
-click_to_connect=Click to connect to the server
-username_needed=\u00a7cPlease follow this command by a user name.
-user_not_online=\u00a7cThat user is not online.
-user_online_at=\u00a7a{0} \u00a7ris online at {1}
-send_cmd_usage=\u00a7cNot enough arguments, usage: /send <server|player|all|current> <target>
-player_only=\u00a7cOnly in game players can use this command
-you_got_summoned=\u00a76Summoned to {0} by {1}
-command_perms_groups=\u00a76You have the following groups: {0}
-command_perms_permission=\u00a79- {0}
-command_ip=\u00a79IP of {0} is {1}
-illegal_chat_characters=\u00a7cillegal characters in chat ({0})
-- 
2.29.2.windows.3

